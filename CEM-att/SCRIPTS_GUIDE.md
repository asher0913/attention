# CEM-att è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ¯ éƒ¨ç½²åˆ°Linux NVIDIAæœåŠ¡å™¨ - å®Œæ•´å®éªŒè¿è¡ŒæŒ‡å—

### æ¨èè¿è¡Œæ–¹æ¡ˆ

**æœ€ä½³é€‰æ‹©ï¼š`run_exp_with_attention_option.sh`** - æœ€çµæ´»ï¼Œæ”¯æŒä¸€é”®åˆ‡æ¢attention/GMM

## ğŸ“‹ æ‰€æœ‰è„šæœ¬è¯¦ç»†è¯´æ˜

### 1. `run_exp_with_attention_option.sh` â­ **æ¨è**

**ç”¨é€”**ï¼šå®Œæ•´çš„CEMå®éªŒ + å¯é€‰æ‹©attention/GMMåˆ†ç±»å™¨
**å®éªŒå†…å®¹**ï¼š
- æ¨¡å‹è®­ç»ƒï¼ˆCEM + attention/GMMï¼‰
- æ¨¡å‹åæ¼”æ”»å‡»æµ‹è¯•ï¼ˆMIAï¼‰
- å¤šå‚æ•°ç½‘æ ¼æœç´¢

**å…³é”®æ§åˆ¶å‚æ•°**ï¼š
```bash
# ç¬¬8è¡Œï¼šé€‰æ‹©åˆ†ç±»å™¨ç±»å‹
USE_ATTENTION=true   # true=ä½¿ç”¨attention, false=ä½¿ç”¨GMM

# ç¬¬10-12è¡Œï¼šAttentionå‚æ•°
NUM_SLOTS=8          # Slotæ•°é‡
ATTENTION_HEADS=8    # æ³¨æ„åŠ›å¤´æ•°
ATTENTION_DROPOUT=0.1 # Dropoutç‡

# ç¬¬15-20è¡Œï¼šåŸºç¡€è®¾ç½®
GPU_id=0             # GPUç¼–å·
arch=vgg11_bn_sgm    # ç½‘ç»œæ¶æ„
batch_size=128       # æ‰¹å¤§å°
cutlayer_list="4"    # åˆ‡å‰²å±‚ï¼ˆVGGç¬¬4å±‚ï¼‰
num_client=1         # å®¢æˆ·ç«¯æ•°é‡

# ç¬¬28-39è¡Œï¼šå®éªŒå‚æ•°
dataset_list="cifar10"                    # æ•°æ®é›†
num_epochs=240                           # è®­ç»ƒè½®æ•°
learning_rate=0.05                       # å­¦ä¹ ç‡
lambd_list="0 8 16"                      # æ¡ä»¶ç†µæƒé‡ï¼ˆæ ¸å¿ƒå‚æ•°ï¼‰
regularization_strength_list="0.01 0.025 0.05 0.1 0.15"  # æ­£åˆ™åŒ–å¼ºåº¦
log_entropy=1                            # ä½¿ç”¨å¯¹æ•°ç†µ
```

**è¿è¡Œå‘½ä»¤**ï¼š
```bash
# 1. ç¼–è¾‘è„šæœ¬é€‰æ‹©attention/GMM
nano run_exp_with_attention_option.sh
# ä¿®æ”¹ç¬¬8è¡Œ: USE_ATTENTION=true

# 2. è¿è¡Œå®Œæ•´å®éªŒ
bash run_exp_with_attention_option.sh
```

---

### 2. `run_exp_attention.sh` 

**ç”¨é€”**ï¼šä¸“é—¨çš„attention vs GMMå¯¹æ¯”å®éªŒï¼ˆç®€åŒ–ç‰ˆï¼‰
**å®éªŒå†…å®¹**ï¼š
- åªåšè®­ç»ƒï¼Œä¸åšæ”»å‡»æµ‹è¯•
- å‡å°‘epochæ•°é‡ï¼ˆ50è½®ï¼‰ç”¨äºå¿«é€Ÿå¯¹æ¯”

**å…³é”®å‚æ•°**ï¼š
```bash
use_attention=true        # æ§åˆ¶æ˜¯å¦ä½¿ç”¨attention
num_epochs=50            # è½®æ•°è¾ƒå°‘ï¼Œé€‚åˆå¿«é€Ÿæµ‹è¯•
lambd_list="1 16"        # åªæµ‹è¯•ä¸¤ä¸ªlambdaå€¼
batch_size=128
```

**è¿è¡Œå‘½ä»¤**ï¼š
```bash
bash run_exp_attention.sh
```

---

### 3. `run_exp.sh` 

**ç”¨é€”**ï¼šåŸå§‹CEMå®éªŒè„šæœ¬ï¼ˆåªæ”¯æŒGMMï¼‰
**å®éªŒå†…å®¹**ï¼š
- å®Œæ•´çš„åŸå§‹CEMå®éªŒ
- ä½¿ç”¨GMMåˆ†ç±»å™¨
- åŒ…å«è®­ç»ƒ + æ”»å‡»æµ‹è¯•

**ç‰¹ç‚¹**ï¼š
- ğŸ”´ **ä¸æ”¯æŒattentionå‚æ•°**
- âœ… å®Œå…¨åŸç‰ˆå®éªŒï¼Œç”¨äºbaselineå¯¹æ¯”
- âœ… æœ€å¤æ‚çš„å‚æ•°è®¾ç½®ï¼ˆ5ç§æ­£åˆ™åŒ–å¼ºåº¦ Ã— 3ç§lambdaå€¼ï¼‰

**è¿è¡Œå‘½ä»¤**ï¼š
```bash
bash run_exp.sh
```

---

### 4. `example_usage.sh`

**ç”¨é€”**ï¼šç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ•™å­¦ç”¨ï¼‰
**å®éªŒå†…å®¹**ï¼š
- æ¼”ç¤ºåŸºæœ¬è®­ç»ƒå‘½ä»¤
- åŒ…å«attentionå’ŒGMMä¸¤ç§æ–¹æ³•

**è¿è¡Œå‘½ä»¤**ï¼š
```bash
bash example_usage.sh
```

---

## ğŸ”§ å…³é”®å‚æ•°è¯¦è§£

### æ ¸å¿ƒCEMå‚æ•°
- **`lambd`**: æ¡ä»¶ç†µæƒé‡ï¼Œæ§åˆ¶æ¡ä»¶ç†µæŸå¤±åœ¨æ€»æŸå¤±ä¸­çš„æ¯”é‡
  - `0`: åªç”¨åˆ†ç±»æŸå¤±ï¼ˆé€€åŒ–ä¸ºæ™®é€šåˆ†ç±»ï¼‰
  - `8-16`: å¹³è¡¡åˆ†ç±»å’Œæ¡ä»¶ç†µ
  - æ›´å¤§å€¼: æ›´å¼ºè°ƒæ¡ä»¶ç†µæœ€å°åŒ–

- **`cutlayer`**: VGGç½‘ç»œåˆ‡å‰²å±‚
  - `4`: åœ¨ç¬¬4å±‚åˆ‡å‰²ï¼Œå‰4å±‚åšç‰¹å¾æå–

- **`log_entropy`**: æ˜¯å¦ä½¿ç”¨å¯¹æ•°ç†µ
  - `1`: ä½¿ç”¨logå½¢å¼çš„æ¡ä»¶ç†µè®¡ç®—
  - `0`: ä½¿ç”¨åŸå§‹æ–¹å·®å½¢å¼

### Attentionä¸“æœ‰å‚æ•°
- **`num_slots`**: Slot Attentionçš„slotæ•°é‡ï¼ˆæ›¿ä»£GMMçš„é«˜æ–¯ç»„ä»¶æ•°ï¼‰
- **`attention_heads`**: å¤šå¤´æ³¨æ„åŠ›çš„å¤´æ•°
- **`attention_dropout`**: æ³¨æ„åŠ›æ¨¡å—çš„dropoutç‡

### é˜²å¾¡/æ”»å‡»å‚æ•°
- **`AT_regularization`**: æ¿€æ´»é˜²å¾¡ç±»å‹
  - `SCA_new`: ä½¿ç”¨SCAé˜²å¾¡
  - `None`: æ— é˜²å¾¡

- **`regularization_strength`**: é˜²å¾¡å¼ºåº¦
- **`ssim_threshold`**: SSIMé˜ˆå€¼ï¼ˆç”¨äºæ”»å‡»è¯„ä¼°ï¼‰

## ğŸš€ æ¨èå®éªŒæµç¨‹

### é˜¶æ®µ1ï¼šå¿«é€ŸéªŒè¯ï¼ˆæ¨èå…ˆè¿è¡Œï¼‰
```bash
# ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬å¿«é€Ÿæµ‹è¯•
bash run_exp_attention.sh
```

### é˜¶æ®µ2ï¼šå®Œæ•´å¯¹æ¯”å®éªŒ
```bash
# 1. è¿è¡Œattentionç‰ˆæœ¬
# ç¼–è¾‘ run_exp_with_attention_option.shï¼Œè®¾ç½® USE_ATTENTION=true
bash run_exp_with_attention_option.sh

# 2. è¿è¡ŒGMM baseline
# ç¼–è¾‘ run_exp_with_attention_option.shï¼Œè®¾ç½® USE_ATTENTION=false  
bash run_exp_with_attention_option.sh
```

## ğŸ“Š å®éªŒç»“æœ

æ‰€æœ‰ç»“æœä¿å­˜åœ¨ï¼š
- **è®­ç»ƒæ—¥å¿—**: `saves/[å®éªŒå]/tensorboard/`
- **æ¨¡å‹æƒé‡**: `saves/[å®éªŒå]/checkpoint_*.tar`
- **æ”»å‡»ç»“æœ**: `saves/[å®éªŒå]/`ç›®å½•ä¸‹çš„å›¾ç‰‡å’Œæ—¥å¿—

## âš¡ æ€§èƒ½å»ºè®®

**GPUå†…å­˜ä¼˜åŒ–**ï¼š
- å¦‚æœGPUå†…å­˜ä¸è¶³ï¼Œå‡å°‘`batch_size`ï¼ˆ128â†’64â†’32ï¼‰
- å‡å°‘`num_slots`ï¼ˆ8â†’4ï¼‰

**æ—¶é—´ä¼˜åŒ–**ï¼š
- å‡å°‘`num_epochs`ï¼ˆ240â†’100â†’50ï¼‰
- å‡å°‘å‚æ•°æœç´¢èŒƒå›´ï¼ˆåªæµ‹è¯•lambd=16ï¼‰

**è°ƒè¯•æ¨¡å¼**ï¼š
```bash
# å¿«é€Ÿè°ƒè¯•ï¼šåªè·‘1ä¸ªepoch
num_epochs=1
lambd_list="16"
regularization_strength_list="0.05"
```
